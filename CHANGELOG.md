# 更新履歴 (Changelog)

## v1.3.0 (2026-02-07): UI模倣モード(BuruBuru)実装およびLINE/Supabase認証の完全対応
### 新機能・追加
- **UI模倣モード (BuruBuru Mode) の実装**:
  - 設定から切り替え可能な「ゲーム風UIモード」を追加。
  - リビングルーム風の背景、キャラクターの吹き出し表示、固定ボトムナビゲーションを搭載。
  - `isBuruBuruMode` フラグによる状態管理と永続化（Zustand + localStorage）。
- **認証・データ同期基盤の強化**:
  - LINE Login (LIFF) と Supabase の連携を実装。
  - `LiffProvider` による認証フローの堅牢化（SSR対応、動的インポート）。
  - ユーザー情報の自動 Supabase Upsert 機能（`api/users/upsert`）。

### バグ修正・改善
- **環境変数の最適化**:
  - `NEXT_PUBLIC_LIFF_ID` の採用と、Vercel上での設定ミス（URL形式の誤入力）を自動補正するロジックを追加。
  - `SUPABASE_SERVICE_ROLE_KEY` の設定不備による `Invalid API key` エラーを解消。
- **モバイル安定性の向上**:
  - スマホ（LINE内ブラウザ）でのハイドレーションエラー（白い画面のクラッシュ）に対処するため、クライアントサイドレンダリングを徹底。
  - 致命的なエラー発生時に「赤い画面」で詳細を表示する `GlobalError` コンポーネントを追加。
- **データ不整合の修正**:
  - ストレージバージョンを `v15` に更新し、古いデータ構造（`debugFlags` 欠損など）によるクラッシュを防止。

## v1.2.1 (2026-02-04): DB移行（Supabase）および収益化（Stripe/PayPay）の計画策定
- DB移行（Supabase）および収益化（Stripe/PayPay）の計画策定、法的免責事項の強化方針を決定。

## v1.2.0 (2026-01-25)
### 実装・改善項目
- **生薬・漢方システムの分離**: 
  - 修行で手に入る「生薬」と、調合で作る「漢方」にシステムを分離。
  - レシピに基づいた「調合（クラフト）」機能を追加。
  - 漢方薬の種類を15種類に大幅拡充（加味逍遙散、十全大補湯、五苓散など）。
- **生薬図鑑へのリニューアル**:
  - メイン名称を「生薬図鑑」に変更。
- **プレミアム機能（漢方調合モード）**:
  - 漢方調合機能をアップグレード（課金想定）項目として実装。
- **世界観・ストーリーの強化**:
  - イントロダクションに情緒的なストーリーテリングを追加。
- **精霊解放プロセスの刷新**:
  - 初期の精霊を「モク（木）」のみに制限。
  - 段階的なアンロックシステム（計8回プレイですべて解放）を導入。
- **UI/UXのブラッシュアップ**:
  - 図鑑画面のタブデザイン改善。
  - 未習得カードでもレシピを確認できるよう改善。
  - **修行（ミニゲーム）の改善**: 
    - 相克ガードにレベル選択システム（初級・中級・上級）を導入。
    - ロック解除要件の統一。
    - アナウンス表記の統一。
    - タイマーやレイアウトの不具合修正。
  - **画像イラストシステムの導入**:
    - AI生成イラスト表示に対応。絵文字へのフォールバック機能。
  - **コンテンツの拡充**:
    - 基本生薬を30種へ拡張。
    - 漢方レシピを20種へ拡張。
  - **デベロッパー（開発者）モードを強化**:
    - ストレージバージョンの刷新とプレミアム機能のデフォルトON化。

## v1.1.0
- ミニゲーム3種（相生、相克、連想）の基礎実装。
- 精霊の元気・気分システムの導入。

## v1.0.0
- 初版リリース。
