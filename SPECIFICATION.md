# 五行精霊と漢方図鑑 仕様書 (v1.3)

## 1. プロダクト概要
五行（木火土金水）の概念を、説明を読ませず「遊びながら自然に覚える」ことを目的としたスマートフォン向けWebアプリケーション（PWA）。
実写的なイラストと洗練されたUIにより、東洋医学の世界観をモダンなデザインで体験できる。

## 2. 技術スタック
- **Frontend**: Next.js (App Router), TypeScript
- **Styling**: Vanilla CSS + Tailwind CSS (Utility classes)
- **State Management**: Zustand
  - 永続化ストレージ: `gogyou-storage-v15` (localStorage)
- **Backend/DB**: Supabase (PostgreSQL)
  - ユーザーデータ同期 (`users` テーブル)
  - Row Level Security (RLS) 適用済み
- **Authentication**: LINE Login (LIFF)
  - LIFF ID: `2009050072-GsZxwyop` (Development)
- **Animations**: Framer Motion, Lucide React (Icons)
- **Deployment**: Vercel

## 3. キャラクター & 素材デザイン
### A. 精霊デザイン
5体の精霊はプロンプト生成された独自のAIイラストを使用。
各属性の性格と季節感を反映したデザインで、`/public/images/spirits/` に保存。

- **モク (木)**: `spirit_moku.png` (せっかち/成長)
- **カ (火)**: `spirit_ka.png` (情熱的/元気)
- **ド (土)**: `spirit_do.png` (穏やか/安定)
- **コン (金)**: `spirit_kon.png` (鋭い/冷静)
- **スイ (水)**: `spirit_sui.png` (神秘的/冬)

### B. 生薬・漢方イラスト
- **nanobananapro プレミアムスタイル**: ミニマルで洗練されたベクターイラストを採用。
- **ハイブリッド表示システム**: 
  - `imageUrl` が設定されている生薬は高画質なイラストを表示。
  - 未作成の生薬は絵文字（Emoji）で自動フォールバック表示。
  - 白背景に水彩画のようなテクスチャを加え、清潔感と高級感を両立。

## 4. UIモード (New!)
### A. クラシックモード (Classic UI)
- **スワイプ操作**: TinderライクなカードスタックUI。
- **直感的な操作**: 左右スワイプで精霊との対話や診断を行う。
- **ミニマルデザイン**: コンテンツに集中できるシンプルな構成。

### B. ぷにぷにモード (BuruBuru Mode / UI Mimic Mode)
- **ゲーム風インターフェース**: RPGのようなリッチな画面構成。
- **リビングルーム背景**: 精霊が部屋にいるような没入感を演出。
- **吹き出し会話**: キャラクターとの対話をより強調した吹き出しUI。
- **ボトムナビゲーション**: 「ホーム」「図鑑」「設定」などへのアクセスが容易な固定ナビゲーションバー。
- **設定**: 設定モーダルからいつでもモード切り替えが可能。

## 5. 主要機能
### A. ホーム画面
- **段階的アンロック**: プレイ回数や成長度に応じて、精霊が木→火→土→金→水の順に覚醒。
- **元気（Genki）システム**: 24時間で5ポイント自然減少。元気が足りないと「精霊のお願い」に応えられなくなる。

### B. 修行（ミニゲーム）
1. **相生チェイン**: 相生(木→火→土→金→水)の順に属性を繋ぐ。ターゲット出現保証ロジック搭載。
2. **相克ガード (レベル制)**: 
   - **初級**: ガイド（五行の環）が常に表示。学習用。
   - **中級**: 30%の確率でガイド消失。
   - **上級**: ガイドなし。自力の知識のみで勝負。
3. **連想仕分け**: キーワードを正しい五行に仕分ける。

### C. 漢方調合（マスター薬師機能）
- **生薬収集**: 修行を通じて30種類の生薬（Crude Drugs）を収集。
- **調合レシピ**: 20種類の漢方レシピ（小青龍湯、加味逍遙散など）を実装。
- **プレミアム機能**: 生薬を組み合わせて漢方を作成し、精霊に「処方」することで大幅に元気を回復させる。

### D. データ同期 & 認証
- **LINEログイン**: LIFFを利用したシームレスなログイン体験。
- **自動同期**: ログイン時にLINEプロフィール情報をSupabaseへ自動保存・更新（Upsert）。
- **堅牢なエラーハンドリング**: 
  - ネットワークエラーや認証エラー発生時に、白い画面ではなく詳細なエラー情報を表示。
  - URL形式のLIFF ID誤入力に対する自動補正機能。

## 6. UI/UX デザイン方針
- **ルビ（ふりがな）完全対応**: `ruby` タグを使用。
- **カードUIの最適化**: 所持数バッジ、ID、属性アイコンが重ならないよう計算された黄金比レイアウト。
- **高級感**: グラデーション、光沢エフェクト、滑らかなモーション。
- **レスポンシブ対応**: モバイル（特にLINE内ブラウザ）での表示を最優先に最適化。

## 7. デベロッパーモード (Master Mode)
- 開発およびデモンストレーション用として、初期化時に以下が自動適用される。
  - 全精霊の解放
  - 全修行レベルのアンロック
  - 全生薬・漢方の全発見および初期在庫(10/5個)の設定
  - プレミアム調合機能の有効化
